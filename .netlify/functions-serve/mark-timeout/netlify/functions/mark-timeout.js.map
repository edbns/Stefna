{
  "version": 3,
  "sources": ["../../../../../../Users/sennie/Desktop/Stefna-main/netlify/functions/mark-timeout.ts"],
  "sourceRoot": "/var/folders/3j/nmp5dkpd4tv8j0yq8f2ln8780000gn/T/tmp-42344-tmJuOc2AICOz",
  "sourcesContent": ["import type { Handler } from '@netlify/functions'\nimport { createClient } from '@supabase/supabase-js'\n\nconst SUPABASE_URL = process.env.SUPABASE_URL!\nconst SUPABASE_SERVICE_ROLE_KEY = process.env.SUPABASE_SERVICE_ROLE_KEY!\n\nexport const handler: Handler = async (event) => {\n  if (event.httpMethod !== 'POST') {\n    return { statusCode: 405, body: 'Method Not Allowed' }\n  }\n\n  try {\n    const body = JSON.parse(event.body || '{}')\n    const id = body?.id as string | undefined\n    const reason = (body?.reason as string | undefined) || 'client finalized after watchdog'\n\n    if (!id) {\n      return { statusCode: 400, body: 'missing id' }\n    }\n\n    const supabase = createClient(SUPABASE_URL, SUPABASE_SERVICE_ROLE_KEY)\n    const { error } = await supabase\n      .from('ai_generations')\n      .update({ status: 'timeout', error: reason })\n      .eq('id', id)\n      .in('status', ['queued', 'processing'])\n\n    if (error) {\n      return { statusCode: 500, body: `db error: ${error.message}` }\n    }\n\n    return { statusCode: 200, body: 'ok' }\n  } catch (e: any) {\n    return { statusCode: 400, body: e?.message || 'bad request' }\n  }\n}\n\n\n"],
  "mappings": ";;;;;;;;;;;;;;;;;;;;AAAA;AAAA;AAAA;AAAA;AAAA;AACA,yBAA6B;AAE7B,IAAM,eAAe,QAAQ,IAAI;AACjC,IAAM,4BAA4B,QAAQ,IAAI;AAEvC,IAAM,UAAmB,OAAO,UAAU;AAC/C,MAAI,MAAM,eAAe,QAAQ;AAC/B,WAAO,EAAE,YAAY,KAAK,MAAM,qBAAqB;AAAA,EACvD;AAEA,MAAI;AACF,UAAM,OAAO,KAAK,MAAM,MAAM,QAAQ,IAAI;AAC1C,UAAM,KAAK,MAAM;AACjB,UAAM,SAAU,MAAM,UAAiC;AAEvD,QAAI,CAAC,IAAI;AACP,aAAO,EAAE,YAAY,KAAK,MAAM,aAAa;AAAA,IAC/C;AAEA,UAAM,eAAW,iCAAa,cAAc,yBAAyB;AACrE,UAAM,EAAE,MAAM,IAAI,MAAM,SACrB,KAAK,gBAAgB,EACrB,OAAO,EAAE,QAAQ,WAAW,OAAO,OAAO,CAAC,EAC3C,GAAG,MAAM,EAAE,EACX,GAAG,UAAU,CAAC,UAAU,YAAY,CAAC;AAExC,QAAI,OAAO;AACT,aAAO,EAAE,YAAY,KAAK,MAAM,aAAa,MAAM,OAAO,GAAG;AAAA,IAC/D;AAEA,WAAO,EAAE,YAAY,KAAK,MAAM,KAAK;AAAA,EACvC,SAAS,GAAQ;AACf,WAAO,EAAE,YAAY,KAAK,MAAM,GAAG,WAAW,cAAc;AAAA,EAC9D;AACF;",
  "names": []
}
